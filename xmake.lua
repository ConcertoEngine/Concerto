add_rules('mode.debug')
add_repositories('Concerto-xrepo https://github.com/ConcertoEngine/xmake-repo.git main')
add_repositories('nazara-engine-repo https://github.com/NazaraEngine/xmake-repo.git')
add_requires('gtest', 'ConcertoCore')
add_requires('nazaraengine', { configs = { audio = false, network = false, physics2d = false, physics3d = false, utility = true, plugin_assimp = false, with_symbols = true  } })

target('Concerto')
    set_kind('binary')
    set_symbols('debug')
    set_warnings('everything')
    set_languages('cxx20')
    add_includedirs('Include', 'Include/Ecs', 'Include/Ecs/Systems', 'Include/Ecs/Systems/NazaraRenderer', 'Include/Ecs/Components')
    add_files('Src/*.cpp', 'Src/Ecs/*.cpp', 'Src/Ecs/Systems/*.cpp','Src/Ecs/Systems/NazaraRenderer/*.cpp')
    add_packages('nazaraengine')
    add_packages('ConcertoCore')
    after_build(function(target)
        print("Copying resources...")
        local binaryPath = "$(buildir)/$(plat)/$(arch)/$(mode)"
        os.mkdir(binaryPath .. "/assets")
        os.cp("./config.json", binaryPath .. "/config.json")
        os.cp("assets/**", binaryPath .. "/assets")
        print("Copying resources... Done !")
    end)

target('ConcertoUnitTests')
    set_kind('binary')
    set_symbols('debug')
    set_warnings('everything')
    set_languages('cxx20')
    set_optimize('none')
    add_includedirs('Include', 'Include/Ecs', 'Include/Ecs/Systems')
    add_files('Src/Ecs/*.cpp', 'tests/*.cpp')
    add_packages('gtest', 'ConcertoCore')
